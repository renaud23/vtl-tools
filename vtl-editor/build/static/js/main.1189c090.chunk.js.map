{"version":3,"sources":["editor/events/actions/index.js","editor/events/initial-state.js","editor/events/reducers/general-reducer.js","editor/events/reducers/selection-reducer.js","editor/events/reducers/tempory-changes.js","editor/events/content-changes/index.js","editor/tools/split-lines.js","editor/events/reducers/source-edit.js","editor/events/reducers/index.js","editor/events/context/index.js","editor/events/event-callbacks/key-binding.js","editor/events/event-callbacks/editor-keydown-callback.js","editor/components/tokens-layer/token.js","editor/components/tokens-layer/row.js","editor/components/tokens-layer/tokens-layer.js","editor/components/tokens-layer/step-hrange.js","editor/components/tokens-layer/step-filter-tokens.js","editor/components/tokens-layer/step-vrange.js","editor/components/tokens-layer/tokens-layer-container.js","editor/components/overlay-layer/overlay-layer.js","editor/components/overlay-layer/horizontal-scrollrange/track.js","editor/components/overlay-layer/horizontal-scrollrange/horizontal-scrollrange.js","editor/components/overlay-layer/horizontal-scrollrange/horizontal-scrollrange.container.js","editor/components/overlay-layer/vertical-scrollrange/track.js","editor/components/overlay-layer/vertical-scrollrange/scrollrange.js","editor/components/overlay-layer/vertical-scrollrange/scrollrange.container.js","editor/components/overlay-layer/cursor/cursor.js","editor/components/overlay-layer/cursor/cursor.container.js","editor/components/overlay-layer/selection/selection.js","editor/components/overlay-layer/selection/selection.container.js","editor/components/overlay-layer/overlay-layer.container.js","editor/components/editor.js","editor/tokenizer/tokenizer-worker-simple.js","editor/components/font-metric.js","editor/components/editor-container.js","index.js"],"names":["PARSING_END","parsingEnd","tokens","errors","type","payload","CHANGE_VERTICAL_SCROLLRANGE","changeVerticalScrollrange","range","CHANGE_HORIZONTAL_SCROLLRANGE","changeHorizontalScrollrange","CHANGE_SCROLLRANGE","changeScrollrange","vertical","horizontal","MOUSE_DOWN","mouseDown","row","index","MOUSE_DRAG","mouseDrag","MOUSE_UP","mouseUp","CHAR_DOWN","charDown","char","CONSUME_CONTENT_TEMPORY_CHANGE","consumeContentTemporyChange","UPDATE_SOURCE","updateSource","source","dispatch","undefined","zIndex","lines","verticalScrollrange","start","stop","offset","horizontalScrollrange","fontMetric","maxLengthRow","overlaySize","width","height","cursor","anchor","extent","temporyContentChanges","reducer","state","action","actions","reduceChangeVerticalScrollrange","reduceChangeScrollrange","reduceChangeHorizontalScrollrange","reduceMouseDown","reduceMouseUp","reduceMoveDrag","push","text","contentChanges","reduceCharDown","CRLF","getLineSeparator","reduce","l","i","newLines","nl","substr","nstart","length","computeChange","join","Math","max","reducers","callbacks","reverse","a","call","combine","general","selection","temporyChanges","reduceParsingEnd","split","reduceUpdateSource","React","createContext","KEY","ENTER","HOME","END","TAB","PAGE_UP","PAGE_DOWN","CONTEXT_MENU","TABULATION","String","fromCharCode","UNBINDED_KEY","CONTROL","ALT","SHIFT","isUnbindedKey","key","indexOf","isCharCode","c","test","e","stopPropagation","preventDefault","stopAndPrevent","keyDownOverlayCallback","memo","className","value","line","tokenParts","map","t","classnames","filterTokensWithVRange","hRange","filter","tStart","tStop","min","tWidth","posTok","partStart","partLength","filterLineTokens","useContext","EditorContext","useState","linesFiltered","setLinesFiltered","useEffect","fillLinesWithTokens","tokensFiltered","lStart","lStop","filteringUtilsTokens","stack","consumeTokens","rest","toks","lineWithToken","tokensLeft","StepFilterTokens","linesWithTokens","setLinesWithTokens","isInRange","StepVRange","visibles","setVisibles","vRange","next","TokensContainer","layer","forwardRef","ref","children","onMouseDown","onMouseUp","onMouseMove","onKeydown","tabIndex","onDragStart","onKeyDown","style","START_DRAG_X","left","onDrag","drag","setDrag","mousemove","useCallback","clientX","mouseup","window","addEventListener","removeEventListener","trackWidth","trackLeft","cally","how","HorizontallScrollrangeContainer","limite","setLimite","setTrackWidth","setTrackLeft","parentWidth","setParentWidth","parentEl","useRef","current","getBoundingClientRect","round","nextStart","START_DRAG_Y","top","clientY","trackHeight","trackTop","VerticalScrollrangeContainer","setTrackHeight","setTrackTop","parentHeight","setParentHeight","CursorContainer","hr","vr","fm","Selection","blocs","getBlocs","first","last","getBlocsOnSingleRowSelection","Array","fill","_","getBlocsOnMultiRowSelection","computeBlocs","SelectionContainer","setBlocs","orderingSelection","bloc","rangifyBlocs","computeVerticalScrollrange","computeHorizontalScrollrange","getRelativePos","el","pageX","pageY","x","y","scrollX","scrollY","getCursorPosition","trunc","OverlayLayerContainer","containerEl","computeScrollrange","createKeydownCallback","ID","parseVtl","worker","Worker","currentIdTask","pusherTask","content","callback","clearTimeout","setTimeout","at","Date","getTime","id","postMessage","onmessage","end","console","log","data","createWorkerCallback","createVtlTaksManager","EditorContainer","useReducer","initialState","prepareDefaultToken","Provider","EditorRoot","setFontMetric","defaultProps","render","setContent","fetch","then","response","rule","document","getElementById"],"mappings":"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","file":"static/js/main.1189c090.chunk.js","sourcesContent":["/** */\r\nexport const PARSING_END = \"vtl-editor/parsing-end\";\r\nexport const parsingEnd = (tokens, errors) => ({\r\n  type: PARSING_END,\r\n  payload: { tokens, errors }\r\n});\r\n\r\n/** */\r\nexport const CHANGE_VERTICAL_SCROLLRANGE =\r\n  \"vtl-editor/change-vertical-scrollrange\";\r\nexport const changeVerticalScrollrange = range => ({\r\n  type: CHANGE_VERTICAL_SCROLLRANGE,\r\n  payload: { range }\r\n});\r\n\r\n/** */\r\nexport const CHANGE_HORIZONTAL_SCROLLRANGE =\r\n  \"vtl-editor/change-horizontal-scrollrange\";\r\nexport const changeHorizontalScrollrange = range => ({\r\n  type: CHANGE_HORIZONTAL_SCROLLRANGE,\r\n  payload: { range }\r\n});\r\n\r\n/** */\r\nexport const CHANGE_SCROLLRANGE = \"vtl-editor/change-scrollrange\";\r\nexport const changeScrollrange = (vertical, horizontal) => ({\r\n  type: CHANGE_SCROLLRANGE,\r\n  payload: { vertical, horizontal }\r\n});\r\n\r\n/** */\r\nexport const MOUSE_DOWN = \"vtl-editor/mouse-down\";\r\nexport const mouseDown = (row, index) => ({\r\n  type: MOUSE_DOWN,\r\n  payload: { row, index }\r\n});\r\n\r\n/** */\r\nexport const MOUSE_DRAG = \"vtl-editor/mouse-drag\";\r\nexport const mouseDrag = (row, index) => ({\r\n  type: MOUSE_DRAG,\r\n  payload: { row, index }\r\n});\r\n\r\n/** */\r\nexport const MOUSE_UP = \"vtl-editor/mouse-up\";\r\nexport const mouseUp = (row, index) => ({\r\n  type: MOUSE_UP,\r\n  payload: { row, index }\r\n});\r\n\r\n/** */\r\nexport const CHAR_DOWN = \"vtl-editor/char-down\";\r\nexport const charDown = char => ({ type: CHAR_DOWN, payload: { char } });\r\n\r\n/** */\r\nexport const CONSUME_CONTENT_TEMPORY_CHANGE =\r\n  \"vtl-editor/consume-content-tempory-change\";\r\nexport const consumeContentTemporyChange = () => ({\r\n  type: CONSUME_CONTENT_TEMPORY_CHANGE\r\n});\r\n\r\n/** */\r\nexport const UPDATE_SOURCE = \"vtl-editor/update-source\";\r\nexport const updateSource = source => ({\r\n  type: UPDATE_SOURCE,\r\n  payload: { source }\r\n});\r\n","export default {\r\n  dispatch: undefined,\r\n  /** general */\r\n  zIndex: 0,\r\n  source: \"\",\r\n  lines: [\"\"],\r\n  tokens: [],\r\n  verticalScrollrange: { start: 0, stop: 0, offset: 1 },\r\n  horizontalScrollrange: { start: 0, stop: 0, offset: 0 },\r\n  fontMetric: undefined,\r\n  maxLengthRow: 0,\r\n  /** selection */\r\n  overlaySize: { width: undefined, height: undefined },\r\n  cursor: undefined,\r\n  anchor: undefined,\r\n  extent: undefined,\r\n  /** content change */\r\n  temporyContentChanges: [] // before parse\r\n};\r\n","import * as actions from \"../actions\";\r\n\r\nconst reduceChangeVerticalScrollrange = (state, { payload: { range } }) => ({\r\n  ...state,\r\n  verticalScrollrange: range\r\n});\r\n\r\nconst reduceChangeHorizontalScrollrange = (state, { payload: { range } }) => ({\r\n  ...state,\r\n  horizontalScrollrange: range\r\n});\r\n\r\nconst reduceChangeScrollrange = (\r\n  state,\r\n  { payload: { vertical, horizontal } }\r\n) => ({\r\n  ...state,\r\n  verticalScrollrange: vertical,\r\n  horizontalScrollrange: horizontal\r\n});\r\n\r\n/** */\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case actions.CHANGE_VERTICAL_SCROLLRANGE: {\r\n      return reduceChangeVerticalScrollrange(state, action);\r\n    }\r\n    case actions.CHANGE_SCROLLRANGE: {\r\n      return reduceChangeScrollrange(state, action);\r\n    }\r\n    case actions.CHANGE_HORIZONTAL_SCROLLRANGE: {\r\n      return reduceChangeHorizontalScrollrange(state, action);\r\n    }\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport default reducer;\r\n","import * as actions from \"../actions\";\r\n\r\nconst reduceMouseDown = (state, { payload: { row, index } }) => ({\r\n  ...state,\r\n  cursor: { row, index },\r\n  anchor: { row, index },\r\n  extent: undefined\r\n});\r\n\r\nconst reduceMouseUp = (state, { payload: { row, index } }) => {\r\n  const { anchor } = state;\r\n  if (!anchor) {\r\n    return state;\r\n  }\r\n  if (anchor.row === row && anchor.index === index) {\r\n    return { ...state, anchor: undefined };\r\n  }\r\n  return { ...state, cursor: { row, index }, extent: { row, index } };\r\n};\r\n\r\nconst reduceMoveDrag = (state, { payload: { row, index } }) => {\r\n  const { anchor } = state;\r\n  if (anchor && (anchor.index !== index || anchor.row !== row)) {\r\n    return { ...state, extent: { row, index } };\r\n  }\r\n  return state;\r\n};\r\n\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case actions.MOUSE_DOWN: {\r\n      return reduceMouseDown(state, action);\r\n    }\r\n    case actions.MOUSE_UP: {\r\n      return reduceMouseUp(state, action);\r\n    }\r\n    case actions.MOUSE_DRAG: {\r\n      return reduceMoveDrag(state, action);\r\n    }\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport default reducer;\r\n","import * as actions from \"../actions\";\r\nimport * as contentChanges from \"../content-changes\";\r\n\r\nconst reduceCharDown = (state, { payload: { char } }) => {\r\n  const { cursor } = state;\r\n  const temporyContentChanges = [];\r\n  if (cursor) {\r\n    temporyContentChanges.push(contentChanges.insertText(cursor, `${char}`));\r\n  }\r\n  return { ...state, temporyContentChanges };\r\n};\r\n\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case actions.CHAR_DOWN: {\r\n      return reduceCharDown(state, action);\r\n    }\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport default reducer;\r\n","/** */\r\nexport const INSERT_TEXT = \"content-change/insert-text\";\r\nexport const insertText = (cursor, text) => ({\r\n  type: INSERT_TEXT,\r\n  payload: { cursor, text }\r\n});\r\n\r\nexport const reduceInsertText = (lines, { cursor, text }) => {\r\n  const { row } = cursor;\r\n  // const line = lines[cursor.row];\r\n  // const tokens = line.tokens.map(t => {\r\n  //   const start = t.start - line.start;\r\n  //   const stop = t.stop - line.start;\r\n\r\n  //   if (index >= start && index <= stop) {\r\n  //     return { ...t, stop: stop + text.length };\r\n  //   }\r\n  //   return t;\r\n  // });\r\n\r\n  lines.map(line => {\r\n    if (row === line.row) {\r\n      const tokens = line.tokens.map(t => {\r\n        return t;\r\n      });\r\n      return { ...line, tokens };\r\n    }\r\n    if (row > line.row) {\r\n      return { line };\r\n    }\r\n\r\n    return line;\r\n  });\r\n  return lines;\r\n};\r\n","const CR = \"\\r\";\r\nconst LF = \"\\n\";\r\nconst CRLF = `${CR}${LF}`;\r\n\r\nexport const removeEndLine = content => content.replace(CRLF, \"\");\r\n\r\nexport const getLineSeparator = () => CRLF;\r\n\r\nexport const splitLines = content =>\r\n  typeof content === \"string\" ? content.split(CRLF) : content;\r\n","import * as actions from \"../actions\";\r\nimport { getLineSeparator } from \"../../tools\";\r\n\r\n// const consumeTokens\r\n\r\nconst computeChange = ({ lines, cursor, tokens }, char) => {\r\n  const { index, row } = cursor;\r\n  return lines.reduce(\r\n    ({ newLines, start, tokens }, l, i) => {\r\n      const nl =\r\n        i === row ? `${l.substr(0, index)}${char}${l.substr(index)}` : l;\r\n\r\n      let nstart = start;\r\n      if (i < row) {\r\n        nstart += l.length + getLineSeparator().length;\r\n      }\r\n      if (i === row) {\r\n        nstart += index;\r\n      }\r\n      return {\r\n        newLines: [...newLines, nl],\r\n        start: nstart,\r\n        tokens\r\n      };\r\n    },\r\n    { newLines: [], start: 0, tokens }\r\n  );\r\n};\r\n\r\nconst reduceCharDown = (state, { payload: { char } }) => {\r\n  const { cursor, lines, maxLengthRow } = state;\r\n  const { row, index } = cursor;\r\n  const { newLines, tokens } = computeChange(state, char);\r\n\r\n  const source = newLines.join(getLineSeparator());\r\n\r\n  return {\r\n    ...state,\r\n    lines: newLines,\r\n    tokens,\r\n    source,\r\n    maxLengthRow: Math.max(lines[row].length, maxLengthRow)\r\n  };\r\n};\r\n\r\nconst reduceUpdateSource = (state, { payload: { source } }) => {\r\n  const lines = source.split(getLineSeparator());\r\n  const maxLengthRow = lines.reduce((a, l) => (l.length > a ? l.length : a), 0);\r\n  return { ...state, source, lines, maxLengthRow };\r\n};\r\n\r\nconst reduceParsingEnd = (state, { payload: { errors, tokens } }) => {\r\n  return {\r\n    ...state,\r\n    errors,\r\n    tokens\r\n  };\r\n};\r\n\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case actions.PARSING_END: {\r\n      return reduceParsingEnd(state, action);\r\n    }\r\n    case actions.CHAR_DOWN: {\r\n      return reduceCharDown(state, action);\r\n    }\r\n    case actions.UPDATE_SOURCE: {\r\n      return reduceUpdateSource(state, action);\r\n    }\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport default reducer;\r\n","import general from \"./general-reducer\";\r\nimport selection from \"./selection-reducer\";\r\nimport temporyChanges from \"./tempory-changes\";\r\nimport sourceEdit from \"./source-edit\";\r\n\r\n/* */\r\nconst combine = (...callbacks) =>\r\n  callbacks.reverse().reduce(\r\n    (a, call) => {\r\n      return (state, action) => a(call(state, action), action);\r\n    },\r\n    state => state\r\n  );\r\n\r\nconst reducers = combine(general, selection, temporyChanges, sourceEdit);\r\n\r\n/** */\r\nexport default (state, action) => {\r\n  const next = reducers(state, action);\r\n  // console.debug(action, state, next);\r\n  return next;\r\n};\r\n","import React from \"react\";\r\n\r\nexport default React.createContext({});\r\n","const KEY = {};\r\n\r\n/* */\r\nKEY.ALT = \"Alt\";\r\nKEY.SHIFT = \"Shift\";\r\nKEY.CONTROL = \"Control\";\r\nKEY.ENTER = \"Enter\";\r\nKEY.ARROW_LEFT = \"ArrowLeft\";\r\nKEY.ARROW_RIGHT = \"ArrowRight\";\r\nKEY.ARROW_UP = \"ArrowUp\";\r\nKEY.ARROW_DOWN = \"ArrowDown\";\r\nKEY.BACK_SPACE = \"Backspace\";\r\nKEY.DELETE = \"Delete\";\r\nKEY.ENTER = \"Enter\";\r\nKEY.HOME = \"Home\";\r\nKEY.END = \"End\";\r\nKEY.TAB = \"Tab\";\r\nKEY.PAGE_UP = \"PageUp\";\r\nKEY.PAGE_DOWN = \"PageDown\";\r\nKEY.CONTEXT_MENU = \"ContextMenu\";\r\nKEY.TABULATION = String.fromCharCode(9);\r\n\r\n/* */\r\nconst UNBINDED_KEY = [\r\n  KEY.CONTROL,\r\n  KEY.ALT,\r\n  KEY.SHIFT,\r\n  \"F1\",\r\n  \"F2\",\r\n  \"F3\",\r\n  \"F4\",\r\n  \"F5\",\r\n  \"F6\",\r\n  \"F7\",\r\n  \"F8\",\r\n  \"F9\",\r\n  \"F10\",\r\n  \"F11\",\r\n  \"F12\",\r\n  \"CapsLock\",\r\n  \"Escape\",\r\n  \"AltGraph\",\r\n  \"Insert\",\r\n  \"Dead\",\r\n  \"Meta\",\r\n  \"ScrollLock\",\r\n  \"AudioVolumeMute\",\r\n  \"AudioVolumeDown\",\r\n  \"AudioVolumeUp\",\r\n  \"NumLock\"\r\n];\r\n\r\n/* */\r\nKEY.isUnbindedKey = key => UNBINDED_KEY.indexOf(key) !== -1;\r\n\r\n/* */\r\nKEY.isCharCode = c =>\r\n  /^[\\w-+*=/?,!;.:{}/\\\\$*%()\"#@µ<>'~|& [\\]éôêûîèäëïüöùààç]{1}$/gim.test(c); // il en manquera !\r\n\r\nexport default KEY;\r\n","import KEY from \"./key-binding\";\r\nimport * as actions from \"../actions\";\r\n\r\n/* */\r\nconst stopAndPrevent = e => {\r\n  e.stopPropagation();\r\n  e.preventDefault();\r\n};\r\n\r\n/* */\r\nconst keyDownOverlayCallback = dispatch => e => {\r\n  stopAndPrevent(e);\r\n  if (KEY.isUnbindedKey(e.key)) return false;\r\n  if (KEY.isCharCode(e.key)) {\r\n    dispatch(actions.charDown(e.key));\r\n  }\r\n};\r\n\r\n/* */\r\nexport default dispatch => keyDownOverlayCallback(dispatch);\r\n","import React from \"react\";\r\n\r\nfunction Token({ className, value }) {\r\n  return <span className={className}>{value}</span>;\r\n}\r\n\r\nexport default React.memo(Token);\r\n","import React from \"react\";\r\nimport Token from \"./token\";\r\n\r\n/**\r\n *\r\n * @param {*} rowStart\r\n * @param {*} valueRow\r\n * @param {*} token\r\n */\r\n// const computeTokenValue = ({ value: rowValue, start: rowStart }) => token => {\r\n//   const { start, stop, value } = token;\r\n\r\n//   return value.substr(\r\n//     Math.max(0, rowStart - start),\r\n//     Math.min(rowValue.length, stop - start + 1)\r\n//   );\r\n// };\r\n\r\nfunction Row({ line }) {\r\n  // const compute = computeTokenValue(line);\r\n  return (\r\n    <div className=\"row\">\r\n      {line.tokenParts.map((t, i) => (\r\n        <Token key={i} value={t.value} className={t.className} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default React.memo(Row);\r\n","import React from \"react\";\r\nimport Row from \"./row\";\r\nimport classnames from \"classnames\";\r\n\r\nfunction TokenLayer({ lines }) {\r\n  return (\r\n    <div className={classnames(\"vtl-editor-tokens\", \"noselect\")}>\r\n      {lines.map((line, i) => (\r\n        <Row key={i} line={line} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default React.memo(TokenLayer);\r\n","import React, { useState, useContext, useEffect } from \"react\";\r\nimport { EditorContext } from \"../../events\";\r\nimport TokensLayer from \"./tokens-layer\";\r\n\r\n/**\r\n *\r\n * @param {*} hRange\r\n */\r\nconst filterLineTokens = hRange => line => {\r\n  const tokenParts = line.tokens.reduce((a, t) => {\r\n    const tStart = Math.max(t.start - line.start, 0);\r\n    const tStop = Math.min(t.stop - line.start, line.value.length - 1);\r\n    const tWidth = tStop - tStart + 1;\r\n    const min = Math.min(hRange.start, tStart);\r\n    const max = Math.max(hRange.stop, tStop);\r\n\r\n    if (max - min + 1 < hRange.offset + tWidth) {\r\n      const posTok = Math.max(line.start - t.start, 0);\r\n      const partStart = Math.max(posTok + hRange.start - tStart, posTok);\r\n      const partLength =\r\n        Math.min(tStop, hRange.stop) - Math.max(hRange.start, tStart) + 1;\r\n\r\n      return [\r\n        ...a,\r\n        {\r\n          ...t,\r\n          value: t.value.substr(partStart, partLength)\r\n        }\r\n      ];\r\n    }\r\n    return a;\r\n  }, []);\r\n\r\n  return { ...line, tokenParts };\r\n};\r\n\r\n/**\r\n *\r\n * @param {*} lines\r\n * @param {*} hRange\r\n */\r\nconst filterTokensWithVRange = lines => hRange => {\r\n  const filter = filterLineTokens(hRange);\r\n  return lines.map(filter);\r\n};\r\n\r\nfunction StepHRange({ lines }) {\r\n  const { state } = useContext(EditorContext);\r\n  const { horizontalScrollrange } = state;\r\n  const [linesFiltered, setLinesFiltered] = useState([]);\r\n  useEffect(() => {\r\n    setLinesFiltered(filterTokensWithVRange(lines)(horizontalScrollrange));\r\n  }, [lines, horizontalScrollrange]);\r\n  return <TokensLayer lines={linesFiltered} />;\r\n}\r\n\r\nexport default React.memo(StepHRange);\r\n","import React, { useState, useContext, useEffect } from \"react\";\r\nimport { EditorContext } from \"../../events\";\r\nimport StepHRange from \"./step-hrange\";\r\n\r\n/**\r\n *\r\n * @param {*} l\r\n * @param {*} tokens\r\n */\r\nconst consumeTokens = (l, tokens) => {\r\n  const [t, ...rest] = tokens;\r\n  if (t) {\r\n    if (t.stop < l.start) {\r\n      return consumeTokens(l, rest);\r\n    }\r\n    const min = Math.min(l.start, t.start);\r\n    const max = Math.max(l.stop, t.stop);\r\n    const limite = l.stop - l.start + t.stop - t.start;\r\n    if (max - min <= limite) {\r\n      const nl = { ...l, tokens: [...l.tokens, t] };\r\n      if (t.stop === l.stop) {\r\n        return [nl, rest];\r\n      }\r\n      if (t.stop > l.stop) {\r\n        return [nl, tokens];\r\n      }\r\n      if (t.stop < l.stop) {\r\n        return consumeTokens(nl, rest);\r\n      }\r\n    }\r\n\r\n    return [l, rest];\r\n  }\r\n\r\n  return [l, rest];\r\n};\r\n\r\nconst filteringUtilsTokens = lines => tokens => {\r\n  const lStart = lines[0].start;\r\n  const lStop = lines[lines.length - 1].stop;\r\n  return tokens.filter(t => {\r\n    if (t.stop >= lStart && t.start <= lStop) {\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n};\r\n\r\n/**\r\n *\r\n * @param {*} lines\r\n * @param {*} tokens\r\n */\r\nconst fillLinesWithTokens = lines => tokens => {\r\n  if (tokens.length && lines.length) {\r\n    const tokensFiltered = filteringUtilsTokens(lines)(tokens);\r\n\r\n    const nl = lines.reduce(\r\n      ({ stack, toks }, l) => {\r\n        const [lineWithToken, tokensLeft] = consumeTokens(l, toks);\r\n\r\n        return {\r\n          stack: [...stack, lineWithToken],\r\n          toks: tokensLeft\r\n        };\r\n      },\r\n      { stack: [], toks: [...tokensFiltered] }\r\n    ).stack;\r\n    return nl;\r\n  }\r\n\r\n  return lines;\r\n};\r\n\r\n/**\r\n *\r\n * @param {*} lines\r\n * @param {*} hRange\r\n */\r\n\r\nfunction StepFilterTokens({ lines }) {\r\n  const { state, dispatch } = useContext(EditorContext);\r\n  const { tokens, temporyContentChanges } = state;\r\n  const [linesWithTokens, setLinesWithTokens] = useState([]);\r\n\r\n  useEffect(() => {\r\n    setLinesWithTokens(fillLinesWithTokens(lines)(tokens));\r\n  }, [lines, tokens, temporyContentChanges, dispatch]);\r\n\r\n  return <StepHRange lines={linesWithTokens} />;\r\n}\r\n\r\nexport default StepFilterTokens;\r\n","import React, { useState, useContext, useEffect } from \"react\";\r\nimport { EditorContext } from \"../../events\";\r\nimport { getLineSeparator } from \"../../tools\";\r\nimport StepFilterTokens from \"./step-filter-tokens\";\r\n\r\n/**\r\n *\r\n * @param {*} i\r\n * @param {*} param1\r\n */\r\nconst isInRange = (i, { start, offset }) =>\r\n  i >= start && i <= start + offset - 1;\r\n\r\n/**\r\n *\r\n * @param {*} lines\r\n * @param {*} hRange\r\n */\r\nconst getVisiblesLines = vRange => lines => {\r\n  const l = lines.reduce(\r\n    ({ stack, next }, l, i) => ({\r\n      stack: isInRange(i, vRange)\r\n        ? [\r\n            ...stack,\r\n            {\r\n              value: l,\r\n              row: i,\r\n              start: next,\r\n              stop: next + l.length - 1,\r\n              tokens: []\r\n            }\r\n          ]\r\n        : stack,\r\n      next: l.length + next + getLineSeparator().length\r\n    }),\r\n    { stack: [], next: 0 }\r\n  ).stack;\r\n\r\n  return l;\r\n};\r\n\r\nfunction StepVRange({ lines }) {\r\n  const { state } = useContext(EditorContext);\r\n  const { verticalScrollrange } = state;\r\n  const [visibles, setVisibles] = useState([]);\r\n  useEffect(() => {\r\n    setVisibles(getVisiblesLines(verticalScrollrange)(lines));\r\n  }, [lines, verticalScrollrange]);\r\n\r\n  return <StepFilterTokens lines={visibles} />;\r\n}\r\n\r\nexport default StepVRange;\r\n","import React, { useContext } from \"react\";\r\nimport { EditorContext } from \"../../events\";\r\nimport StepVRange from \"./step-vrange\";\r\n\r\nfunction TokensContainer() {\r\n  const { state } = useContext(EditorContext);\r\n  const { lines } = state;\r\n  return <StepVRange lines={lines} />;\r\n}\r\n\r\nexport default TokensContainer;\r\n","import React from \"react\";\r\n\r\nconst layer = React.forwardRef(function OverlayLayer(\r\n  { children, onMouseDown, onMouseUp, onMouseMove, zIndex, onKeydown },\r\n  ref\r\n) {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      tabIndex=\"0\"\r\n      className=\"vtl-editor-overlay\"\r\n      onMouseDown={onMouseDown}\r\n      onMouseUp={onMouseUp}\r\n      onMouseMove={onMouseMove}\r\n      onDragStart={e => e.preventDefault()}\r\n      onKeyDown={onKeydown}\r\n      style={{ zIndex }}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default React.memo(layer);\r\n","import React, { useEffect, useState, useCallback } from \"react\";\r\n\r\nlet START_DRAG_X = 0;\r\n\r\nfunction Track({ left, width, onDrag }) {\r\n  const [drag, setDrag] = useState(false);\r\n  const mousemove = useCallback(\r\n    e => {\r\n      if (drag) {\r\n        onDrag(true, e.clientX - START_DRAG_X);\r\n        START_DRAG_X = e.clientX;\r\n      }\r\n    },\r\n    [drag, onDrag]\r\n  );\r\n\r\n  const mouseup = useCallback(\r\n    e => {\r\n      e.stopPropagation();\r\n      setDrag(false);\r\n      onDrag(false);\r\n    },\r\n    [onDrag]\r\n  );\r\n\r\n  useEffect(() => {\r\n    window.addEventListener(\"mouseup\", mouseup);\r\n    window.addEventListener(\"mousemove\", mousemove);\r\n    return () => {\r\n      window.removeEventListener(\"mouseup\", mouseup);\r\n      window.removeEventListener(\"mousemove\", mousemove);\r\n    };\r\n  }, [mousemove, mouseup, onDrag]);\r\n\r\n  return (\r\n    <div\r\n      className=\"track noselect\"\r\n      style={{ left, width }}\r\n      onMouseDown={e => {\r\n        e.stopPropagation();\r\n        START_DRAG_X = e.clientX;\r\n        setDrag(true);\r\n        onDrag(true, 0);\r\n      }}\r\n      onMouseUp={e => {\r\n        mouseup(e);\r\n      }}\r\n    ></div>\r\n  );\r\n}\r\n\r\nexport default React.memo(Track);\r\n","import React, { useState, useCallback } from \"react\";\r\n\r\nimport classnames from \"classnames\";\r\nimport Track from \"./track\";\r\n\r\nfunction HorizontalScrollrange({ trackWidth, trackLeft, onDrag, zIndex }, ref) {\r\n  const [drag, setDrag] = useState(false);\r\n  const cally = useCallback(\r\n    (state, how) => {\r\n      setDrag(state);\r\n      if (state) {\r\n        onDrag(how);\r\n      }\r\n    },\r\n    [onDrag]\r\n  );\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      style={{ zIndex: zIndex + 1 }}\r\n      className={classnames(\"vtl-editor-horizontal-scrollrange\", {\r\n        \"on-track\": drag\r\n      })}\r\n    >\r\n      <Track width={trackWidth} left={trackLeft} onDrag={cally} />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default React.forwardRef(HorizontalScrollrange);\r\n","import React, {\r\n  useContext,\r\n  useEffect,\r\n  useState,\r\n  useRef,\r\n  useCallback\r\n} from \"react\";\r\nimport HorizontalScrollrange from \"./horizontal-scrollrange\";\r\nimport { EditorContext, actions } from \"../../../events\";\r\n\r\nconst LEFT_BORDER_MARGIN = 2; // in char\r\n\r\nfunction HorizontallScrollrangeContainer() {\r\n  const { state, dispatch } = useContext(EditorContext);\r\n  const { horizontalScrollrange: range = {}, maxLengthRow, zIndex } = state;\r\n  const { start, offset } = range;\r\n  const [limite, setLimite] = useState(0);\r\n  const [trackWidth, setTrackWidth] = useState(0);\r\n  const [trackLeft, setTrackLeft] = useState(0);\r\n  const [parentWidth, setParentWidth] = useState(0);\r\n  const parentEl = useRef();\r\n  useEffect(() => {\r\n    if (parentEl.current) {\r\n      const { width } = parentEl.current.getBoundingClientRect();\r\n      if (maxLengthRow) {\r\n        setTrackWidth(\r\n          Math.round((offset / (maxLengthRow + LEFT_BORDER_MARGIN)) * width)\r\n        );\r\n        setParentWidth(width);\r\n      }\r\n    }\r\n  }, [parentEl, offset, maxLengthRow]);\r\n\r\n  useEffect(() => {\r\n    if (parentEl.current) {\r\n      const { width } = parentEl.current.getBoundingClientRect();\r\n      if (maxLengthRow) {\r\n        setTrackLeft(\r\n          Math.round(\r\n            (start / (maxLengthRow + LEFT_BORDER_MARGIN - offset)) *\r\n              (width - trackWidth)\r\n          )\r\n        );\r\n      }\r\n    }\r\n  }, [parentEl, start, maxLengthRow, offset, trackWidth]);\r\n\r\n  useEffect(() => {\r\n    setLimite(parentWidth - trackWidth);\r\n  }, [parentWidth, trackWidth]);\r\n\r\n  const cally = useCallback(\r\n    how => {\r\n      const next = Math.min(Math.max(trackLeft + how, 0), limite);\r\n      const nextStart = Math.round(\r\n        (next / limite) * (maxLengthRow + LEFT_BORDER_MARGIN - offset)\r\n      );\r\n      dispatch(\r\n        actions.changeHorizontalScrollrange({\r\n          start: nextStart,\r\n          stop: nextStart + offset - 1,\r\n          offset\r\n        })\r\n      );\r\n      setTrackLeft(next);\r\n    },\r\n    [dispatch, limite, maxLengthRow, offset, trackLeft]\r\n  );\r\n\r\n  return (\r\n    <HorizontalScrollrange\r\n      trackWidth={trackWidth}\r\n      trackLeft={trackLeft}\r\n      ref={parentEl}\r\n      onDrag={cally}\r\n      zIndex={zIndex}\r\n    />\r\n  );\r\n}\r\n\r\nexport default HorizontallScrollrangeContainer;\r\n","import React, { useEffect, useState, useCallback } from \"react\";\r\n\r\nlet START_DRAG_Y = 0;\r\n\r\nfunction Track({ top, height, onDrag }) {\r\n  const [drag, setDrag] = useState(false);\r\n  const mousemove = useCallback(\r\n    e => {\r\n      if (drag) {\r\n        onDrag(true, e.clientY - START_DRAG_Y);\r\n        START_DRAG_Y = e.clientY;\r\n      }\r\n    },\r\n    [drag, onDrag]\r\n  );\r\n  useEffect(() => {\r\n    const mouseup = e => {\r\n      setDrag(false);\r\n      onDrag(false);\r\n    };\r\n    window.addEventListener(\"mouseup\", mouseup);\r\n    window.addEventListener(\"mousemove\", mousemove);\r\n    return () => {\r\n      window.removeEventListener(\"mouseup\", mouseup);\r\n      window.removeEventListener(\"mousemove\", mousemove);\r\n    };\r\n  }, [mousemove, onDrag]);\r\n\r\n  return height ? (\r\n    <div\r\n      className=\"track noselect\"\r\n      style={{ top, height }}\r\n      onMouseDown={e => {\r\n        e.stopPropagation();\r\n        START_DRAG_Y = e.clientY;\r\n        setDrag(true);\r\n        onDrag(true, 0);\r\n      }}\r\n    ></div>\r\n  ) : null;\r\n}\r\n\r\nexport default React.memo(Track);\r\n","import React, { useState, useCallback } from \"react\";\r\n\r\nimport classnames from \"classnames\";\r\nimport Track from \"./track\";\r\n\r\nfunction VerticalScrollrange({ trackHeight, trackTop, onDrag, zIndex }, ref) {\r\n  const [drag, setDrag] = useState(false);\r\n  const cally = useCallback(\r\n    (state, how) => {\r\n      setDrag(state);\r\n      if (state) {\r\n        onDrag(how);\r\n      }\r\n    },\r\n    [onDrag]\r\n  );\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      style={{ zIndex: zIndex + 1 }}\r\n      className={classnames(\"vtl-editor-vertical-scrollrange\", {\r\n        \"on-track\": drag\r\n      })}\r\n    >\r\n      <Track height={trackHeight} top={trackTop} onDrag={cally} />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default React.forwardRef(VerticalScrollrange);\r\n","import React, { useContext, useEffect, useState, useRef } from \"react\";\r\n\r\nimport VerticalScrollrange from \"./scrollrange\";\r\nimport { EditorContext, actions } from \"../../../events\";\r\n\r\nfunction VerticalScrollrangeContainer() {\r\n  const { state, dispatch } = useContext(EditorContext);\r\n  const { verticalScrollrange: range = {}, lines, zIndex } = state;\r\n  const { start, offset } = range;\r\n\r\n  const [trackHeight, setTrackHeight] = useState(0);\r\n  const [trackTop, setTrackTop] = useState(0);\r\n  const [parentHeight, setParentHeight] = useState(0);\r\n  const parentEl = useRef();\r\n  const margin = 10;\r\n\r\n  useEffect(() => {\r\n    if (parentEl.current && lines.length > offset) {\r\n      const { height } = parentEl.current.getBoundingClientRect();\r\n      setTrackHeight(\r\n        Math.max(Math.round((offset / (lines.length + margin)) * height), 15)\r\n      );\r\n      setParentHeight(height);\r\n    }\r\n  }, [parentEl, offset, lines]);\r\n\r\n  useEffect(() => {\r\n    if (parentEl.current && lines.length) {\r\n      const { height } = parentEl.current.getBoundingClientRect();\r\n      setTrackTop(\r\n        Math.round((start / (lines.length + margin)) * (height - trackHeight))\r\n      );\r\n    }\r\n  }, [parentEl, start, lines, trackHeight]);\r\n\r\n  return (\r\n    <VerticalScrollrange\r\n      zIndex={zIndex}\r\n      trackHeight={trackHeight}\r\n      trackTop={trackTop}\r\n      ref={parentEl}\r\n      onDrag={how => {\r\n        if (lines.length > offset) {\r\n          const next = Math.min(\r\n            Math.max(trackTop + how, 0),\r\n            parentHeight - trackHeight\r\n          );\r\n\r\n          const nextStart = Math.min(\r\n            Math.round(\r\n              (next / (parentHeight - trackHeight)) * (lines.length + margin)\r\n            ),\r\n            lines.length - offset + margin\r\n          );\r\n\r\n          setTrackTop(next);\r\n          dispatch(\r\n            actions.changeVerticalScrollrange({\r\n              start: nextStart,\r\n              stop: nextStart + offset - 1,\r\n              offset\r\n            })\r\n          );\r\n        }\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\nexport default VerticalScrollrangeContainer;\r\n","import React from \"react\";\r\n\r\nfunction Cursor({ top, left }) {\r\n  return (\r\n    <div\r\n      className=\"vtl-editor-cursor\"\r\n      style={{ top, left }}\r\n      onDragStart={e => e.preventDefault()}\r\n    />\r\n  );\r\n}\r\n\r\nexport default React.memo(Cursor);\r\n","import React, { useContext } from \"react\";\r\nimport { EditorContext } from \"../../../events\";\r\nimport Cursor from \"./cursor\";\r\n\r\nfunction CursorContainer() {\r\n  const { state } = useContext(EditorContext);\r\n\r\n  const {\r\n    cursor,\r\n    horizontalScrollrange: hr,\r\n    verticalScrollrange: vr,\r\n    fontMetric: fm\r\n  } = state;\r\n  if (cursor) {\r\n    const { row, index } = cursor;\r\n    const top = (row - vr.start) * fm.height;\r\n    const left = (index - hr.start) * fm.width;\r\n    return index >= hr.start &&\r\n      index <= hr.stop &&\r\n      row >= vr.start &&\r\n      row <= vr.stop ? (\r\n      <Cursor top={top} left={left} />\r\n    ) : null;\r\n  }\r\n  return null;\r\n}\r\n\r\nexport default CursorContainer;\r\n","import React from \"react\";\r\n\r\nfunction Selection({ blocs, zIndex }) {\r\n  return blocs.map(({ top, left, width }, i) => (\r\n    <span\r\n      key={i}\r\n      className=\"vtl-editor-selection-bloc\"\r\n      style={{ top, left, width, zIndex }}\r\n    />\r\n  ));\r\n}\r\n\r\nexport default Selection;\r\n","import React, { useContext, useEffect, useState } from \"react\";\r\nimport { EditorContext } from \"../../../events\";\r\nimport Selection from \"./selection\";\r\n\r\nconst MAX_LENGTH = 9999999;\r\n\r\nconst getBlocsOnMultiRowSelection = (first, last) => {\r\n  const length = last.row - first.row + 1;\r\n  const blocs = new Array(length).fill({}).map((_, i) => {\r\n    if (i === 0) {\r\n      return { row: first.row, index: first.index, length: MAX_LENGTH };\r\n    }\r\n    if (i === length - 1) {\r\n      return { row: last.row, index: 0, length: last.index };\r\n    }\r\n    return { row: first.row + i, index: 0, length: MAX_LENGTH };\r\n  });\r\n  return blocs;\r\n};\r\n\r\nconst getBlocsOnSingleRowSelection = (first, last) => [\r\n  {\r\n    row: first.row,\r\n    index: first.index,\r\n    length: last.index - first.index\r\n  }\r\n];\r\n\r\n/** */\r\nconst getBlocs = (first, last) => {\r\n  return first.row === last.row\r\n    ? getBlocsOnSingleRowSelection(first, last)\r\n    : getBlocsOnMultiRowSelection(first, last);\r\n};\r\n\r\n/**\r\n *\r\n * @param {*} hr\r\n * @param {*} vr\r\n */\r\nconst rangifyBlocs = (hr, vr) => blocs => {\r\n  const visibles = blocs.reduce((a, bloc) => {\r\n    const { index, row, length } = bloc;\r\n    if (row >= vr.start && row <= vr.stop) {\r\n      const range =\r\n        Math.max(hr.stop, index + length) - Math.min(hr.start, index);\r\n      if (range < hr.offset + length) {\r\n        return [\r\n          ...a,\r\n          {\r\n            row: row - vr.start,\r\n            index: Math.max(index - hr.start, 0),\r\n            length: Math.min(index + length, hr.offset) - index\r\n          }\r\n        ];\r\n      }\r\n    }\r\n\r\n    return a;\r\n  }, []);\r\n  return visibles;\r\n};\r\n\r\n/**\r\n *\r\n * @param {*} anchor\r\n * @param {*} extent\r\n */\r\nfunction orderingSelection(anchor, extent) {\r\n  if (\r\n    anchor.row > extent.row ||\r\n    (anchor.row === extent.row && extent.index < anchor.index)\r\n  ) {\r\n    return { first: extent, last: anchor };\r\n  }\r\n  return { first: anchor, last: extent };\r\n}\r\n\r\n/**\r\n *\r\n * @param {*} blocs\r\n * @param {*} fontMetric\r\n */\r\nconst computeBlocs = (blocs, { width, height }) =>\r\n  blocs.map(({ row, index, length }) => ({\r\n    left: index * width,\r\n    width: length * width,\r\n    top: row * height\r\n  }));\r\n\r\n/* **/\r\nfunction SelectionContainer() {\r\n  const { state } = useContext(EditorContext);\r\n  const {\r\n    anchor,\r\n    extent,\r\n    horizontalScrollrange: hr,\r\n    verticalScrollrange: vr,\r\n    fontMetric,\r\n    zIndex\r\n  } = state;\r\n  const [blocs, setBlocs] = useState([]);\r\n  const [visibles, setVisibles] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (extent && anchor) {\r\n      const { first, last } = orderingSelection(anchor, extent);\r\n      setBlocs(getBlocs(first, last));\r\n    } else {\r\n      setBlocs([]);\r\n    }\r\n  }, [anchor, extent]);\r\n\r\n  useEffect(() => {\r\n    if (blocs.length) {\r\n      setVisibles(rangifyBlocs(hr, vr)(blocs));\r\n    }\r\n  }, [blocs, hr, vr]);\r\n\r\n  if (extent && anchor) {\r\n    return (\r\n      <Selection blocs={computeBlocs(visibles, fontMetric)} zIndex={zIndex} />\r\n    );\r\n  }\r\n  return null;\r\n}\r\n\r\nexport default SelectionContainer;\r\n","import React, { useRef, useContext, useEffect, useState } from \"react\";\r\nimport Overlay from \"./overlay-layer\";\r\nimport { EditorContext, actions, createKeydownCallback } from \"../../events\";\r\nimport HorizontalScrollrange from \"./horizontal-scrollrange\";\r\nimport VerticalScrollrange from \"./vertical-scrollrange\";\r\nimport Cursor from \"./cursor\";\r\nimport Selection from \"./selection\";\r\n\r\nconst computeVerticalScrollrange = (height, fontMetric) => {\r\n  const offset = Math.round(height / fontMetric.height);\r\n  return { start: 0, stop: offset - 1, offset };\r\n};\r\n\r\nconst computeHorizontalScrollrange = (width, fontMetric) => {\r\n  const offset = Math.round(width / fontMetric.width);\r\n  return { start: 0, stop: offset - 1, offset };\r\n};\r\n\r\nconst computeScrollrange = (parentEl, fontMetric) => {\r\n  const { height, width } = parentEl.getBoundingClientRect();\r\n  return {\r\n    verticalScrollrange: computeVerticalScrollrange(height, fontMetric),\r\n    horizontalScrollrange: computeHorizontalScrollrange(width, fontMetric)\r\n  };\r\n};\r\n\r\n/**\r\n *\r\n * @param {*} el\r\n */\r\nconst getRelativePos = el => e => {\r\n  const { pageX, pageY } = e;\r\n  const { x, y } = el.getBoundingClientRect();\r\n  return { x: pageX - x - window.scrollX, y: pageY - y - window.scrollY };\r\n};\r\n\r\n/**\r\n *\r\n * @param {*} param0\r\n */\r\nconst getCursorPosition = ({\r\n  verticalScrollrange: vr,\r\n  horizontalScrollrange: hr,\r\n  fontMetric: fm,\r\n  lines\r\n}) => ({ x, y }) => {\r\n  const row = Math.min(vr.start + Math.trunc(y / fm.height), lines.length - 1);\r\n  const index = Math.min(\r\n    hr.start + Math.trunc(x / fm.width),\r\n    lines[row].length\r\n  );\r\n  return { row, index };\r\n};\r\n\r\n/* **/\r\nfunction OverlayLayerContainer() {\r\n  const { state, dispatch } = useContext(EditorContext);\r\n  const { fontMetric, zIndex } = state;\r\n  const [drag, setDrag] = useState(false);\r\n  const containerEl = useRef();\r\n\r\n  useEffect(() => {\r\n    if (containerEl.current) {\r\n      const { verticalScrollrange, horizontalScrollrange } = computeScrollrange(\r\n        containerEl.current,\r\n        fontMetric\r\n      );\r\n      dispatch(\r\n        actions.changeScrollrange(verticalScrollrange, horizontalScrollrange)\r\n      );\r\n    }\r\n  }, [containerEl, fontMetric, dispatch]);\r\n\r\n  return (\r\n    <Overlay\r\n      ref={containerEl}\r\n      zIndex={zIndex}\r\n      onMouseDown={e => {\r\n        const { row, index } = getCursorPosition(state)(\r\n          getRelativePos(containerEl.current)(e)\r\n        );\r\n        dispatch(actions.mouseDown(row, index));\r\n        setDrag(true);\r\n      }}\r\n      onMouseUp={e => {\r\n        if (drag) {\r\n          const { row, index } = getCursorPosition(state)(\r\n            getRelativePos(containerEl.current)(e)\r\n          );\r\n          dispatch(actions.mouseUp(row, index));\r\n          setDrag(false);\r\n        }\r\n      }}\r\n      onMouseMove={e => {\r\n        if (drag) {\r\n          const { row, index } = getCursorPosition(state)(\r\n            getRelativePos(containerEl.current)(e)\r\n          );\r\n          dispatch(actions.mouseDrag(row, index));\r\n        }\r\n      }}\r\n      onKeydown={createKeydownCallback(dispatch)}\r\n    >\r\n      <HorizontalScrollrange />\r\n      <VerticalScrollrange />\r\n      <Cursor />\r\n      <Selection />\r\n    </Overlay>\r\n  );\r\n}\r\n\r\nexport default OverlayLayerContainer;\r\n","import React from \"react\";\r\nimport TokensLayer from \"./tokens-layer\";\r\nimport OverlayLayer from \"./overlay-layer\";\r\nimport \"./editor.scss\";\r\n\r\nfunction Editor() {\r\n  return (\r\n    <pre className=\"vtl-editor\">\r\n      <div className=\"vtl-editor-rownum\" />\r\n      <div className=\"vtl-editor-container\">\r\n        <OverlayLayer />\r\n        <TokensLayer />\r\n      </div>\r\n    </pre>\r\n  );\r\n}\r\n\r\nexport default React.memo(Editor);\r\n","const PUSHER_INTERVAL = 70;\r\nlet ID = 0;\r\n\r\nconst createWorkerCallback = (content, cally) => {\r\n  const start = new Date().getTime();\r\n  return e => {\r\n    const end = new Date();\r\n    console.log(\r\n      \"%cparse (in millisec)\",\r\n      \"color: green;\",\r\n      e.data.id,\r\n      end - start\r\n    );\r\n    cally(e.data);\r\n  };\r\n};\r\n\r\nexport const createVtlTaksManager = () => {\r\n  const worker = new Worker(\"/worker-vtl-2.0-insee.js\");\r\n  let currentIdTask = undefined;\r\n  let pusherTask = undefined;\r\n\r\n  return (content, callback) => {\r\n    if (!content.length) return;\r\n\r\n    if (pusherTask) {\r\n      window.clearTimeout(pusherTask);\r\n    }\r\n\r\n    pusherTask = window.setTimeout(() => {\r\n      pusherTask = undefined;\r\n      const at = new Date().getTime();\r\n      const id = `${ID++}#${at}`;\r\n      worker.postMessage({ action: \"parse\", content, id });\r\n      worker.onmessage = createWorkerCallback(content, data => {\r\n        if (data.id === currentIdTask) {\r\n          callback(data);\r\n        }\r\n        pusherTask = undefined;\r\n      });\r\n\r\n      currentIdTask = id;\r\n    }, PUSHER_INTERVAL);\r\n  };\r\n};\r\n","import React from \"react\";\r\n\r\nexport default React.forwardRef(function FontMetrique({ value }, ref) {\r\n  return (\r\n    <pre className=\"vtl-editor\">\r\n      <span className=\"font-metric\" ref={ref}>\r\n        {value}\r\n      </span>\r\n    </pre>\r\n  );\r\n});\r\n","import React, { useReducer, useEffect, useRef, useState } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport Editor from \"./editor\";\r\nimport { createVtlTaksManager } from \"../tokenizer\";\r\nimport { reducers, initialState, EditorContext, actions } from \"../events\";\r\nimport FontMetric from \"./font-metric\";\r\n\r\nconst TEMPLATE_FONT_METRIC = \"font_FONTyuyiyoproorot***@Mm\";\r\nconst parseVtl = createVtlTaksManager();\r\n\r\nconst prepareDefaultToken = content => [\r\n  {\r\n    value: content,\r\n    start: 0,\r\n    stop: content.length,\r\n    className: \"unmapped\"\r\n  }\r\n];\r\n\r\n/** */\r\nfunction EditorContainer({ content, fontMetric, zIndex }) {\r\n  const [state, dispatch] = useReducer(reducers, {\r\n    ...initialState,\r\n    zIndex,\r\n    fontMetric\r\n  });\r\n\r\n  const { source } = state;\r\n\r\n  useEffect(() => {\r\n    dispatch(actions.updateSource(content));\r\n    dispatch(actions.parsingEnd(prepareDefaultToken(content), []));\r\n  }, [content]);\r\n\r\n  useEffect(() => {\r\n    parseVtl(source, ({ tokens = [], errors = [] } = {}) => {\r\n      dispatch(actions.parsingEnd(tokens, errors));\r\n    });\r\n  }, [source]);\r\n\r\n  return (\r\n    <EditorContext.Provider value={{ state, dispatch }}>\r\n      <Editor />\r\n    </EditorContext.Provider>\r\n  );\r\n}\r\n\r\nfunction EditorRoot({ content, zIndex }) {\r\n  const [fontMetric, setFontMetric] = useState(undefined);\r\n  const containerEl = useRef(null);\r\n  useEffect(() => {\r\n    if (containerEl.current && !fontMetric) {\r\n      const { width, height } = containerEl.current.getBoundingClientRect();\r\n      setFontMetric({ width: width / TEMPLATE_FONT_METRIC.length, height });\r\n    }\r\n  }, [fontMetric, containerEl]);\r\n\r\n  return fontMetric ? (\r\n    <EditorContainer\r\n      content={content}\r\n      fontMetric={fontMetric}\r\n      zIndex={zIndex}\r\n    />\r\n  ) : (\r\n    <FontMetric value={TEMPLATE_FONT_METRIC} ref={containerEl} />\r\n  );\r\n}\r\n\r\nEditorRoot.propTypes = {\r\n  content: PropTypes.string,\r\n  zIndex: PropTypes.number\r\n};\r\nEditorRoot.defaultProps = { content: \"\", zIndex: 0 };\r\n\r\nexport default EditorRoot;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { render } from \"react-dom\";\r\nimport { VtlEditor } from \"./editor\";\r\nimport \"./application.scss\";\r\nimport \"./vtl-tokens.scss\";\r\n\r\nconst fetchContent = () => fetch(\"/rule.vtl\").then(response => response.text());\r\n\r\nconst App = () => {\r\n  const [content, setContent] = useState(\"\");\r\n  useEffect(() => {\r\n    fetchContent().then(rule => setContent(rule));\r\n  }, []);\r\n  return (\r\n    <div className=\"application\">\r\n      <div className=\"editor\">\r\n        <VtlEditor content={content} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nrender(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}